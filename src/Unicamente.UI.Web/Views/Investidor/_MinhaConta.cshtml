@model Unicamente.UI.Web.Models.InvestidorViewModel

<div id="DadosPessoais" class="tabcontent" style="display:none">

    <div class="section-title">
        <h2>Dados Pessoais</h2>
        @* <p>Você é um investidor ou um corretor? Complete seu cadastro abaixo</p> *@
    </div>
  
    <div class="col-lg-12">

        <form id="form-investidor-dados-pessoais" method="post" data-ajax-method="post" data-ajax="true" data-ajax-url="/Investidor/AtualizarDadosPessoais" data-ajax-success="onSucess" role="form" class="php-email-form">
            <input asp-for="ID" type="hidden" />
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">

                <div class="row">

                    <div class="col-md-6">
                        <label class="control-label">Nome Completo</label>
                        <input asp-for="Nome" class="form-control somenteTexto" id="nome" placeholder="João da Silva" required />
                        <span asp-validation-for="Nome" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label asp-for="Celular" class="control-label"></label>
                        <input asp-for="Celular" type="text" class="form-control" id="celular" required />
                        <span asp-validation-for="Celular" class="text-danger"></span>
                    </div>
                    <div class="col-md-3" style="margin-top:7px;">
                        <label asp-for="Complemento.Nascimento" class="control-label"></label>
                        <input asp-for="Complemento.Nascimento" type="date" class="form-control" id="nascimento" required />
                        <span asp-validation-for="Complemento.Nascimento" class="text-danger"></span>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-3">
                        <label asp-for="Complemento.CPF" class="control-label"></label>
                        <input asp-for="Complemento.CPF" type="text" class="form-control" id="cpf" required />
                    </div>
                    <div class="col-md-3">
                        <label asp-for="Complemento.RG" class="control-label"></label>
                        <input asp-for="Complemento.RG" class="form-control" id="rg" required />
                        <span asp-validation-for="Complemento.RG" class="text-danger"></span>
                    </div>

                    @*             <div class="col">
                    <label class="control-label">Orgao Expedidor</label>
                    <input asp-for="Complemento.OrgaoExpedidor" class="form-control" id="orgaoexpedidor" required />
                    <span asp-validation-for="Complemento.OrgaoExpedidor" class="text-danger"></span>
                    </div> *@

                    <div class="col-md-4">
                        <label class="control-label">Orgao Expedidor</label>

                        @* <input asp-for="Complemento.OrgaoExpedidor" class="form-control" id="orgaoexpedidor" required /> *@
                        <select asp-for="Complemento.OrgaoExpedidor" asp-items="@ViewBag.TipoDocumento" class="form-control" id="ufrg" required>
                            <option disabled selected>Selecione...</option>
                        </select>

                        <span asp-validation-for="Complemento.OrgaoExpedidor" class="text-danger"></span>
                    </div>

                    <div class="col-md-2">
                        <label class="control-label">UF</label>
                        @* <input asp-for="Complemento.UFRG" class="form-control" id="ufrg" required /> *@
                        <select asp-for="Complemento.UFRG" asp-items="@ViewBag.UF" class="form-control" id="ufrg" required>
                        </select>

                        <span asp-validation-for="Complemento.UFRG" class="text-danger"></span>
                    </div>
                </div>
                <br>
                <div style="text-align: right">
                    <button id="cadastrar-investidor" class="btn-salvar" type="submit" style="background: #38be3b">Salvar</button>
                </div>
            </div>
        </form>
    </div>

</div>

<div id="Endereco" class="tabcontent" style="display:none">
    <div class="section-title">
        <h2>Endereço</h2>
        @* <p>Você é um investidor ou um corretor? Complete seu cadastro abaixo</p> *@
    </div>
    <div class="col-lg-12">
        <form id="form-investidor-endereco" method="post" data-ajax-method="post" data-ajax="true" data-ajax-url="/Investidor/AtualizarEndereco" data-ajax-success="onSucess" role="form" class="php-email-form">
            <input asp-for="ID" type="hidden" />
            <div class="form-group">

                <div class="row">
                    <div class="col-md-4">
                        <label asp-for="Complemento.CEP" class="control-label"></label>
                        <input asp-for="Complemento.CEP" class="form-control" id="cep" required />
                        <span asp-validation-for="Complemento.CEP" class="text-danger"></span>
                    </div>
                    <div class="col-sm-7" style="padding-top: 3%;">
                        <img id="img-loader-endereco" src="~/img/loading.gif" style="display: none; height: 48px;" />
                        <span class="text-danger" id="id-cep-invalido" style="display : none">CEP não encontrado, favor inserir endereço.</span>
                    </div>

                </div>
                <br>
                <div class="row">
                    <div class="col-md-6">
                        <label asp-for="Complemento.Logradouro" class="control-label"></label>
                        <input asp-for="Complemento.Logradouro" class="form-control" id="logradouro" required readonly />
                        <span asp-validation-for="Complemento.Logradouro" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="Complemento.Numero" class="control-label"></label>
                        <input asp-for="Complemento.Numero" class="form-control" id="numero" required />
                        <span asp-validation-for="Complemento.Numero" class="text-danger"></span>
                    </div>
                    <div class="col-md-4">
                        <label asp-for="Complemento.Complemento" class="control-label"></label>
                        <input asp-for="Complemento.Complemento" class="form-control" id="complemento" />
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col">
                        <label asp-for="Complemento.Bairro" class="control-label"></label>
                        <input asp-for="Complemento.Bairro" class="form-control" id="bairro" required readonly />
                        <span asp-validation-for="Complemento.Bairro" class="text-danger"></span>
                    </div>
                    <div class="col">
                        <label asp-for="Complemento.Cidade" class="control-label"></label>
                        <input asp-for="Complemento.Cidade" class="form-control" id="cidade" required readonly />
                        <span asp-validation-for="Complemento.Cidade" class="text-danger"></span>
                    </div>
                    <div class="col">
                        <label asp-for="Complemento.Estado" class="control-label"></label>
                        <input asp-for="Complemento.Estado" class="form-control" id="uf" required readonly />
                        <span asp-validation-for="Complemento.Estado" class="text-danger"></span>
                    </div>
                </div>
                <br>
                <div style="text-align: right">
                    <button type="submit" class="btn-salvar" style="background: #38be3b">Salvar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div id="Seguranca" class="tabcontent" style="display:none">
    <div class="section-title">
        <h2>Segurança</h2>
        @* <p>Você é um investidor ou um corretor? Complete seu cadastro abaixo</p> *@
    </div>
    <div class="col-lg-12">
        <form asp-controller="Investidor" asp-action="Create" method="post" role="form" class="php-email-form">
            <input asp-for="ID" type="hidden" />
            <div class="form-group">

                <div class="row">
                    <div class="col-md-6">
                        <label class="control-label">Senha antiga</label>
                        <input asp-for="Senha" class="form-control" id="senha" placeholder="*******" required />
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-6">
                        <label class="control-label">Senha</label>
                        <input asp-for="Senha" class="form-control" id="senha" placeholder="*******" required />
                    </div>
                    <div class="col-md-6">
                        <label class="control-label">Confirmar senha</label>
                        <input asp-for="Senha" class="form-control" id="senha" placeholder="*******" required />
                    </div>
                </div>
                <br>
                <div style="text-align: right">
                    <button type="submit" style="background: #38be3b" class="btn-salvar">Salvar</button>
                </div>
            </div>
        </form>
    </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://rawgit.com/RobinHerbots/Inputmask/5.x/dist/jquery.inputmask.js"></script>
<script>
    $(document).ready(function () {
        // $("#celular").inputmask("(99)99999-9999");
        $("#celular").mask("(00) 00000-0000");
        $("#cpf").mask("000.000.000-00");
        $("#rg").mask("0000000000");
        $("#cep").mask("00000-000");
        // $("#nascimento").mask("00/00/0000");

        $("#nome").keypress(function (e) {
            var key = e.keyCode;
            if (key >= 48 && key <= 57) {
                e.preventDefault();
            }
        });

        $("#cep").blur(function () {
            $("#img-loader-endereco").show();
            $("#logradouro").attr('readonly', true);
            $("#cidade").attr('readonly', true);
            $("#uf").attr('readonly', true);
            // $("#pais").attr('readonly', true);
            $("#bairro").attr('readonly', true);

            $.get("/Investidor/ConsultaCEP?cep=" + $(this).val(), function (retorno) {

                debugger;
                if (retorno.success == false) {
                    $("#id-cep-invalido").show();
                    $("#logradouro").val("");
                    $("#cidade").val("");
                    $("#uf").val("");
                    // $("#pais").val("");
                    $("#bairro").val("");

                    $("#img-loader-endereco").hide();
                    $("#logradouro").attr('readonly', false);
                    $("#cidade").attr('readonly', false);
                    $("#uf").attr('readonly', false);
                    // $("#pais").attr('readonly', false);
                    $("#bairro").attr('readonly', false);
                    // $("#txtComplemento").attr('readonly', false);
                } else {
                    $("#id-cep-invalido").hide();
                    $("#logradouro").val(retira_acentos(retorno.retorno.logradouro).toUpperCase());
                    $("#bairro").val(retira_acentos(retorno.retorno.bairro).toUpperCase());
                    $("#cidade").val(retira_acentos(retorno.retorno.cidade).toUpperCase());
                    $("#uf").val(retira_acentos(retorno.retorno.uf).toUpperCase());

                    $("#img-loader-endereco").hide();

                    retorno.retorno.logradouro == "" ? $("#logradouro").attr('readonly', false) : $("#logradouro").attr('readonly', true);
                    retorno.retorno.bairro == "" ? $("#bairro").attr('readonly', false) : $("#bairro").attr('readonly', true);
                    retorno.retorno.cidade == "" ? $("#cidade").attr('readonly', false) : $("#cidade").attr('readonly', true);
                    retorno.retorno.uf == "" ? $("#uf").attr('readonly', false) : $("#uf").attr('readonly', true);

                    // $("#txtComplemento").attr('readonly', false);
                    $("#numero").attr('readonly', false);



                    $("#logradouro").focusout(function () {
                        $("#logradouro").val(retira_acentos($("#logradouro").val()).toUpperCase());
                    });
                    $("#bairro").focusout(function () {
                        $("#bairro").val(retira_acentos($("#bairro").val()).toUpperCase());
                    });
                    $("#cidade").focusout(function () {
                        $("#cidade").val(retira_acentos($("#cidade").val()).toUpperCase());
                    });

                    $("#uf").focusout(function () {
                        $("#uf").val(retira_acentos($("#uf").val()).toUpperCase());
                    });

                    retorno.retorno.logradouro == "" ? $("#logradouro").focus() : $("#numero").focus();
                }
            });
        });

    });

    function retira_acentos(palavra) {
        com_acento = 'áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ';
        sem_acento = 'aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC';
        nova = '';
        for (i = 0; i < palavra.length; i++) {
            if (palavra.substr(i, 1) != "(" && palavra.substr(i, 1) != ")" && com_acento.search(palavra.substr(i, 1)) >= 0 && palavra.substr(i, 1) != ".") {
                nova += sem_acento.substr(com_acento.search(palavra.substr(i, 1)), 1);
            }
            else {
                nova += palavra.substr(i, 1);
            }
        }
        return nova;
    }
    function onSucess(response) {
        if (response.success) {
            exibirPopupSucesso(response.message);
        }
        else {
            exibirPopupErro(response.message);
        }
    }

</script>

